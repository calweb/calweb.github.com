{% if site.sparcet_user %}
<section>
  <h1>My Sparcets</h1>
  <ul id="sparcet_list">
    <li class="loading">:( no Sparcets yet...</li>
  </ul>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript">
         jQuery.noConflict();
        jQuery(function() {
            sparcet.showSparcets({
                user: '9699304f-bf63-4d6b-97b6-fc895bd37a0c',
                count: '5',
                target: '#sparcet_list'
            });

        });
        var sparcet = (function($){
            function render(target, sparcetList){
                var i = 0, fragment = '', t = $(target)[0];

                for(i = 0; i < sparcetList.length; i++) {
                    fragment += '<li><a href="http://sparc.sparcet.com/sparcets/'+sparcetList[i].id+'">'+sparcetList[i].from.name+' said:</a><p>'+sparcetList[i].reason+'</p></li>';
                }
                t.innerHTML = fragment;
            }

            return {
                showSparcets: function(options){
//                    console.log(options.user + " " + options.count);
                    $.ajax({
                        url: "http://sparc.sparcet.com/api/sparcets?limit="+options.count+"&to="+options.user,
                        dataType: 'jsonp',
                        error: function (err) { $(options.target + ' li.loading').addClass('error').text("Error loading feed"); },
                        success: function(response) {
                            var sparcetList = [];
                            if (!response || !response.data) { return; }
                            for (var i = 0; i < response.data.length; i++) {
                                // if (options.skip_forks && data[i].fork) { continue; }
                                sparcetList.push(response.data[i]);
                            }
                            sparcetList.sort(function(a, b) {
                                var aDate = new Date(a.dateSubmitted).valueOf(),
                                        bDate = new Date(b.dateSubmitted).valueOf();

                                if (aDate === bDate) { return 0; }
                                return aDate > bDate ? -1 : 1;
                            });

                            if (options.count) { sparcetList.splice(options.count); }
                            render(options.target, sparcetList);
                        }
                    });
                }
            };
        })(jQuery);
    </script>

</section>
{% endif %}
